---
description: >-
  This feature provides an opportunity to make out an invoice for a B2B or B2C
  client to a specified amount.
---

# Invoices

## Invoice general flow

You should send a request with a particular set of fields to create an invoice. Response will contain a url that you have to forward to a user for payment.

Your user will see an invoice name, amount and currency, and also specific parameters \(depending on invoice type\): timer, possibility to choose payment currency or estimated amount and currency of payment.

If you send a user email in request, this field will be filled out for a user. Otherwise, a user has to fill out this field themselves. After confirming currency and putting email, a user has to pay an invoice using specified address before the expiry of the timer. This address is generated by CoinsPaid.

The invoice type will be externalized depending on the sent parameters. There are 3 types of invoice:

1. Invoice without restriction of payment time. A user chooses a currency of payment themselves without time restriction. Rate will be fixed when a user confirms payment currency.
2. Invoice with time restriction. A user chooses a currency of payment themselves, but the time restriction will be 15 minutes starting from invoice creation.
3. Invoice with time restriction and without a possibility to choose payment currency. User sees the amount and payment currency that he needs to pay.

If a user fails to pay invoice in due time the system will display failed status.

You will receive a callback about successful transaction creation after it appears in the mempool. We will change the timer from 15 minutes to 24 hours. During this period of time the transaction will change its status to confirmed.

After successful confirmation of the transaction, money will be exchanged in a receiver currency and transferred to your account. The Merchant is charged a Fee for Operation after the Funds are credited to the account.

If a user sends the amount of money that more or less than specified one we will send a payback guideline on their email.

## API Endpoint

{% api-method method="post" host="https://app.coinspaid.com/api" path="/v2/invoices/create" %}
{% api-method-summary %}
Create Invoice
{% endapi-method-summary %}

{% api-method-description %}
Create invoice for a client to a specified amount.
{% endapi-method-description %}

{% api-method-spec %}
{% api-method-request %}
{% api-method-body-parameters %}
{% api-method-parameter name="timer" type="boolean" required=true %}
Time on the rate is fixed for invoice payment \(15 minutes\). During this time a user has to pay an invoice.
{% endapi-method-parameter %}

{% api-method-parameter name="name" type="string" required=true %}
Invoice name, that will be displayed to a user
{% endapi-method-parameter %}

{% api-method-parameter name="description" type="string" required=false %}
Invoice description, that will be displayed to a user
{% endapi-method-parameter %}

{% api-method-parameter name="currency" type="string" required=true %}
ISO invoice currency, that you want to receive from a user, for example: **“EUR”**
{% endapi-method-parameter %}

{% api-method-parameter name="sender\_currency" type="string" required=false %}
Currency of user invoice payment \(3d type invoice will be externalized at the time of sending this parameter with timer= true\), example: **“BTC“**
{% endapi-method-parameter %}

{% api-method-parameter name="amount" type="integer" required=true %}
Invoice amount, that you want to receive from a user, example: **“106.75“**
{% endapi-method-parameter %}

{% api-method-parameter name="foreign\_id" type="string" required=true %}
Unique foreign ID in your system, example: "**164**"
{% endapi-method-parameter %}

{% api-method-parameter name="url\_success" type="string" required=true %}
URL on which we redirect user in case of successful invoice payment, example: **“https://merchant.name.com/url\_success“**
{% endapi-method-parameter %}

{% api-method-parameter name="url\_failed" type="string" required=true %}
URL on which we redirect user in case of unsuccessful invoice payment, example: **“https://merchant.name.com/url\_failed“**
{% endapi-method-parameter %}

{% api-method-parameter name="email\_user" type="string" required=false %}
In case the payment amount does not match the amount stated above, we will send an email to this address with instructions on recovery of funds. In case of underpayment, the whole amount will be refunded. In case of overpayment, user will be able to recover the difference by following the instructions.
{% endapi-method-parameter %}
{% endapi-method-body-parameters %}
{% endapi-method-request %}

{% api-method-response %}
{% api-method-response-example httpCode=200 %}
{% api-method-response-example-description %}
Example of success response
{% endapi-method-response-example-description %}

```typescript
{
   "data":{
      "id":79,
      "url":"https://app.coinspaid.com/invoice/RB9NZv",
      "foreign_id":164,
      "name":"TEST NAME",
      "status":"created",
      "currency":"EUR",
      "amount":"106.75",
      "sender_currency":"BTC",
      "sender_amount":null,
      "fixed_at":1581929889,
      "release_at":1581930789
   }
}
```
{% endapi-method-response-example %}

{% api-method-response-example httpCode=400 %}
{% api-method-response-example-description %}
Example of response with errors
{% endapi-method-response-example-description %}

```javascript
{
   "errors":{
      "foreign_id":"The foreign id has already been taken."
   }
}
```
{% endapi-method-response-example %}
{% endapi-method-response %}
{% endapi-method-spec %}
{% endapi-method %}

## Invoice Type

### **1st Type** 

#### Invoice without restriction of payment time

This invoice type allows a user to choose payment currency themselves without time restriction. Rate will be fixed when a user confirms payment currency.

By following the link a user will see the information about invoice and also will be able to choose payment currency.

{% code title="Request example:" %}
```javascript
 "timer": false,
 "name": "Invoice Title",
 "currency": "EUR",
 "amount": 106.75,
 "foreign_id": 196,
 "url_success": "http://success.test",
 "url_failed": "http://failed.test",
```
{% endcode %}

{% code title="Response example:" %}
```javascript
{
   "data":{
      "id":127,
      "url":"https://wallet.coinspaid.com/invoice/iEU3uh",
      "foreign_id":205,
      "address":null,
      "name":"Invoice Title",
      "status":"created",
      "currency":"EUR",
      "amount":"106.75000000",
      "sender_currency":null,
      "sender_amount":null,
      "fixed_at":null,
      "release_at":null
   }
}
```
{% endcode %}

![](../../.gitbook/assets/desktop.png)

After confirming currency and putting email, the rate will be fixed for 15 minutes. During this period of time a user has to pay an invoice using specified address.

![](../../.gitbook/assets/004.png)

### **2nd Type**

#### Invoice with time restriction 

This invoice type allows a user to choose  payment currency themselves, but the time restriction will be 15 minutes starting from invoice creation.

By following the link a user will see the information about invoice, timer and also will be able to choose payment currency. Rate will be fixed after invoice creation.

{% code title="Request example:" %}
```javascript
 "timer": true,
 "name": "Invoice Title",
 "currency": "EUR",
 "amount": 106.75,
 "foreign_id": 196,
 "url_success": "http://success.test",
 "url_failed": "http://failed.test",
```
{% endcode %}

{% code title="Response example:" %}
```javascript
{
   "data":{
      "id":130,
      "url":"https://wallet.coinspaid.com/invoice/XJrbOG",
      "foreign_id":208,
      "address":null,
      "name":"Invoice Title",
      "status":"created",
      "currency":"EUR",
      "amount":"106.75000000",
      "sender_currency":null,
      "sender_amount":null,
      "fixed_at":1582815161,
      "release_at":1582816061
   }
}
```
{% endcode %}

![](../../.gitbook/assets/002.png)

After confirming currency and putting email, a user has to pay an invoice using specified address before the expiry of the timer.

![](../../.gitbook/assets/004%20%282%29.png)

###  **3rd Type** 

#### Invoice with time restriction and without a possibility to choose payment currency

This invoice type allows a user to pay invoice themselves in a definite currency with time restriction for 15 minutes starting from invoice creation.

By following the link a user will see the information about invoice, 15 minutes timer and payment currency. Rate will be fixed after invoice creation.

{% code title="Request example:" %}
```javascript
 "timer": true,
 "name": "Invoice Title",
 "currency": "EUR",
 "sender_currency": "BTC",
 "amount": 106.75,
 "foreign_id": 196,
 "url_success": "http://success.test",
 "url_failed": "http://failed.test",
```
{% endcode %}

{% code title="Response example:" %}
```javascript
{
   "data":{
      "id":131,
      "url":"https://wallet.coinspaid.com/invoice/8ppbsV",
      "foreign_id":209,
      "address":"91TESTBTCADDRESS",
      "name":"Invoice Title",
      "status":"created",
      "currency":"EUR",
      "amount":"106.75000000",
      "sender_currency":"BTC",
      "sender_amount":"0.01060080",
      "fixed_at":1582815352,
      "release_at":1582816252
   }
}
```
{% endcode %}

![](../../.gitbook/assets/003.png)

After putting email, a user has to pay an invoice using specified address before the expiry of the timer.

![](../../.gitbook/assets/004%20%284%29.png)

## Invoice failed

Invoice fails on the occurrence of any of the following:

1. 15 minutes timer expired
2. Transaction has processing status for more than 24 hours
3. A user paid an amount less than was requested. In this case transaction will have confirmed status, but invoice will have failed status

## Invoice callbacks

If invoice payment is paid by installments, You will receive a callback for each part.

```javascript
{
   "id":2688875,
   "type":"deposit_exchange",
   "crypto_address":{
      "id":384710,
      "currency":"BTC",
      "convert_to":"EUR",
      "address":"0x4b41a526d3d12de36bdf969e7b70fd0bd2e0d265",
      "tag":null,
      "foreign_id":"9AW1KI7LesB9yxWcT2T"
   },
   "currency_sent":{
      "currency":"EUR",
      "amount":"500"
   },
   "currency_received":{
      "currency":"BTC",
      "amount":"0.05075",
      "amount_minus_fee":"0.057"
   },
   "transactions":[
      {
         "id":717557,
         "currency":"BTC",
         "transaction_type":"blockchain",
         "type":"deposit",
         "address":"0x4b41a526d3d12de36bdf969e7b70fd0bd2e0d265",
         "tag":null,
         "amount":"0.0406",
         "txid":"0x19f9094e12dfc6cb14910d6057269d10f39dfdc7c8b0d0e22b789c3e5d03b9e7",
         "confirmations":"2"
      }
   ],
   "fees":[
      {
         "type":"fee_crypto_deposit_to_fiat",
         "currency":"BTC",
         "amount":"0.00075"
      }
   ],
   "invoice":{
      "id":168,
      "foreign_id":11,
      "status":"pending",
      "currency":"EUR",
      "sender_currency":"BTC",
      "amount":"500",
      "amount_to_pay":"100"
   },
   "error":"",
   "status":"processing"
}
```

You will receive a callback about successful transaction creation after it appears in the mempool. We will change the timer from 15 minutes to 24 hours. During this period of time the transaction will change its status to confirmed.

```javascript
{
   "id":2688874,
   "type":"deposit_exchange",
   "crypto_address":{
      "id":384709,
      "currency":"BTC",
      "convert_to":"EUR",
      "address":"0x4b41a526d3d12de36bdf969e7b70fd0bd2e0d264",
      "tag":null,
      "foreign_id":"8FW1KI7LesB9yxWcK1K"
   },
   "currency_sent":{
      "currency":"EUR",
      "amount":"500"
   },
   "currency_received":{
      "currency":"BTC",
      "amount":"0.05075",
      "amount_minus_fee":"0.05"
   },
   "transactions":[
      {
         "id":717556,
         "currency":"BTC",
         "transaction_type":"blockchain",
         "type":"deposit",
         "address":"0x4b41a526d3d12de36bdf969e7b70fd0bd2e0d264",
         "tag":null,
         "amount":"0.05075",
         "txid":"0x19f9094e12dfc6cb14910d6057269d10f39dfdc7c8b0d0e22b789c3e5d03b9e6",
         "confirmations":"1"
      }
   ],
   "fees":[
      {
         "type":"fee_crypto_deposit_to_fiat",
         "currency":"BTC",
         "amount":"0.00075"
      }
   ],
   "invoice":{
      "id":167,
      "foreign_id":11,
      "status":"pending",
      "currency":"EUR",
      "sender_currency":"BTC",
      "amount":"500",
      "amount_to_pay":"0"
   },
   "error":"",
   "status":"processing"
}
```

In case of successful invoice payment you will receive the following callback:

```javascript
{
   "id":2688874,
   "type":"deposit_exchange",
   "crypto_address":{
      "id":384709,
      "currency":"BTC",
      "convert_to":"EUR",
      "address":"0x4b41a526d3d12de36bdf969e7b70fd0bd2e0d264",
      "tag":null,
      "foreign_id":"8FW1KI7LesB9yxWcK1K"
   },
   "currency_sent":{
      "currency":"EUR",
      "amount":"500"
   },
   "currency_received":{
      "currency":"BTC",
      "amount":"0.05075",
      "amount_minus_fee":"0.05"
   },
   "transactions":[
      {
         "id":717556,
         "currency":"BTC",
         "transaction_type":"blockchain",
         "type":"deposit",
         "address":"0x4b41a526d3d12de36bdf969e7b70fd0bd2e0d264",
         "tag":null,
         "amount":"0.05075",
         "txid":"0x19f9094e12dfc6cb14910d6057269d10f39dfdc7c8b0d0e22b789c3e5d03b9e6",
         "confirmations":"1"
      }
   ],
   "fees":[
      {
         "type":"fee_crypto_deposit_to_fiat",
         "currency":"BTC",
         "amount":"0.00075"
      }
   ],
   "invoice":{
      "id":167,
      "foreign_id":11,
      "status":"confirmed",
      "currency":"EUR",
      "sender_currency":"BTC",
      "amount":"500",
      "amount_to_pay":"0"
   },
   "error":"",
   "status":"confirmed"
}
```

In case of unsuccessful invoice payment you will receive the following callback:

15 minutes timer expired:

```javascript
{
   "id":167,
   "foreign_id":11,
   "status":"failed",
   "reason":"not_paid",
   "currency":"EUR",
   "sender_currency":"BTC",
   "amount":"500",
   "amount_to_pay":"0",
   "transactions":[
      {
         "id":717556,
         "currency":"BTC",
         "transaction_type":"blockchain",
         "type":"deposit_exchange",
         "address":"0x4b41a526d3d12de36bdf969e7b70fd0bd2e0d264",
         "tag":null,
         "amount":"0.05075",
         "txid":"0x19f9094e12dfc6cb14910d6057269d10f39dfdc7c8b0d0e22b789c3e5d03b9e6",
         "confirmations":"1"
      }
   ],
   "fees":[
      {
         "type":"fee_crypto_deposit_to_fiat",
         "currency":"BTC",
         "amount":"0.00075"
      }
   ],
   "fixed_at":1582620928,
   "release_at":1582621828
}
```

Transaction has processing status for more than 24 hours**:**

```javascript
{
   "id":167,
   "foreign_id":11,
   "status":"failed",
   "reason":"not_confirmed",
   "currency":"EUR",
   "sender_currency":"BTC",
   "amount":"500",
   "amount_to_pay":"500",
   "transactions":[
      {
         "id":717556,
         "currency":"BTC",
         "transaction_type":"blockchain",
         "type":"deposit_exchange",
         "address":"0x4b41a526d3d12de36bdf969e7b70fd0bd2e0d264",
         "tag":null,
         "amount":"0.05075",
         "txid":"0x19f9094e12dfc6cb14910d6057269d10f39dfdc7c8b0d0e22b789c3e5d03b9e6",
         "confirmations":"1"
      }
   ],
   "fees":[
      {
         "type":"fee_crypto_deposit_to_fiat",
         "currency":"BTC",
         "amount":"0.00075"
      }
   ],
   "fixed_at":1582620928,
   "release_at":1582621828
}
```

A user paid an amount less than was requested. In this case transaction will have confirmed status, but invoice will have failed status:

```javascript
{
   "id":167,
   "foreign_id":11,
   "status":"failed",
   "reason":"not_fully_paid",
   "currency":"EUR",
   "sender_currency":"BTC",
   "amount":"500",
   "amount_to_pay":"100",
   "transactions":[
      {
         "id":717556,
         "currency":"BTC",
         "transaction_type":"blockchain",
         "type":"deposit_exchange",
         "status":"confirmed",
         "address":"0x4b41a526d3d12de36bdf969e7b70fd0bd2e0d264",
         "tag":null,
         "amount":"0.0406",
         "txid":"0x19f9094e12dfc6cb14910d6057269d10f39dfdc7c8b0d0e22b789c3e5d03b9e6",
         "confirmations":"13"
      }
   ],
   "fees":[
      {
         "type":"fee_crypto_deposit_to_fiat",
         "currency":"BTC",
         "amount":"0.0006"
      }
   ],
   "fixed_at":1582620928,
   "release_at":1582621828
}
```

